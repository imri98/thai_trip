<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×¤××™ + ×¦×³×× ×’ ×××™ â€” ×˜×‘×¢ ×œ×–×•×’</title>
  <style>
    :root{
      color-scheme: dark;

      --bg1:#0b1020;
      --bg2:#0a1a14;
      --text:#e9eefc;
      --muted:#b6c3ea;
      --line:rgba(255,255,255,.12);
      --accent:#33ffd1;
      --accent2:#7aa6ff;
      --star:#ffd24d;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    html{color-scheme: dark;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans Hebrew", "Rubik", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 80% 10%, rgba(51,255,209,.18), transparent 60%),
        radial-gradient(900px 500px at 15% 25%, rgba(122,166,255,.18), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    a{color:inherit}

    .wrap{max-width:1100px; margin:0 auto; padding:28px 18px 40px;}

    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      align-items:stretch;
      margin-bottom:14px;
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .heroMain{padding:18px 18px 16px;}

    h1{margin:0 0 8px; font-size:28px; letter-spacing:.2px;}
    .sub{color:var(--muted); line-height:1.45; margin:0; font-size:14px;}

    .stats{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      padding:14px 18px 18px;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.10);
    }

    .stat{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(0,0,0,.16);
    }
    .stat b{display:block; font-size:18px; margin-bottom:2px;}
    .stat span{color:var(--muted); font-size:12px;}

    .heroSide{padding:16px 16px 14px; display:flex; flex-direction:column; gap:12px;}

    .tip{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px;
      background: rgba(0,0,0,.16);
    }
    .tipTitle{display:flex; gap:8px; align-items:center; margin-bottom:6px; font-weight:700;}
    .dot{width:10px; height:10px; border-radius:999px; background: var(--accent); box-shadow:0 0 18px rgba(51,255,209,.45)}
    .tip p{margin:0; color:var(--muted); font-size:13px; line-height:1.5;}

    .toolbar{
      position: sticky;
      top:0;
      z-index: 5;
      backdrop-filter: blur(10px);
      padding:12px;
      margin:14px 0 14px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: rgba(10, 14, 28, .62);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }

    .controls{
      display:grid;
      grid-template-columns: 1.2fr .65fr .65fr .65fr .8fr;
      gap:10px;
      align-items:center;
    }

    .input{
      display:flex;
      align-items:center;
      gap:10px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      padding:10px 12px;
      border-radius: 14px;
    }
    .input input{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color:var(--text);
      font-size:14px;
    }
    .input small{color:var(--muted)}

    select{
      width:100%;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      outline:none;
      font-size:14px;
    }
    select:focus{border-color: rgba(51,255,209,.35)}

    /*
      ×©×™×¤×•×¨ ×§×•× ×˜×¨×¡×˜ ×©×œ ×”×˜×§×¡×˜ ×‘×ª×•×š ×¨×©×™××ª ×”×‘×—×™×¨×” (dropdown).
      ×‘×”×¨×‘×” ××›×©×™×¨×™×/×“×¤×“×¤× ×™× ×”×¨×§×¢ ×©×œ ×”×¨×©×™××” ×™×•×¦× ×‘×”×™×¨â€”××– × ×•×ª× ×™× ×˜×§×¡×˜ ×›×”×” ×•×¨×§×¢ ×‘×”×™×¨.
    */
    select option{
      background: #e9eefc;
      color: #0b1020;
    }
    select option:checked{
      background: #7aa6ff;
      color: #0b1020;
    }

    .btnRow{display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap;}

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      transition: transform .08s ease, border-color .2s ease, background .2s ease;
      user-select:none;
      white-space: nowrap;
    }
    .btn:hover{border-color: rgba(255,255,255,.25)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(51,255,209,.35);
      background: linear-gradient(180deg, rgba(51,255,209,.18), rgba(0,0,0,.18));
    }
    .btn.starOn{
      border-color: rgba(255,210,77,.45);
      background: linear-gradient(180deg, rgba(255,210,77,.16), rgba(0,0,0,.18));
    }

    .chips{display:flex; gap:8px; flex-wrap:wrap; padding:10px 0 0;}

    .chip{
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:12px;
      transition: all .15s ease;
    }
    .chip.active{
      color: var(--text);
      border-color: rgba(122,166,255,.45);
      background: linear-gradient(180deg, rgba(122,166,255,.18), rgba(0,0,0,.16));
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 190px;
    }

    .cardTop{padding:14px 14px 12px; border-bottom:1px solid var(--line); background: rgba(0,0,0,.14)}

    .titleRow{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .name{font-size:16px; font-weight:800; margin:0 0 6px;}

    .starBtn{
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      color: rgba(255,255,255,.55);
      width:36px;
      height:36px;
      border-radius: 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      line-height:1;
      user-select:none;
      transition: transform .08s ease, border-color .2s ease, background .2s ease, color .2s ease;
      flex: 0 0 auto;
    }
    .starBtn:hover{border-color: rgba(255,255,255,.25)}
    .starBtn:active{transform: translateY(1px)}
    .starBtn.fav{
      color: var(--star);
      border-color: rgba(255,210,77,.45);
      background: linear-gradient(180deg, rgba(255,210,77,.14), rgba(0,0,0,.16));
      box-shadow: 0 0 18px rgba(255,210,77,.18);
    }

    .meta{display:flex; gap:8px; flex-wrap:wrap; color:var(--muted); font-size:12px;}
    .pill{
      border:1px solid var(--line);
      background: rgba(0,0,0,.14);
      padding:5px 8px;
      border-radius:999px;
      white-space: nowrap;
    }

    .pill.diff{
      border-color: rgba(122,166,255,.35);
    }

    .cardBody{padding:12px 14px; color:var(--text); line-height:1.5; font-size:13px; flex:1;}
    .cardBody p{margin:0}

    .cardActions{
      display:flex;
      gap:8px;
      padding:12px 14px 14px;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.10);
      flex-wrap:wrap;
      justify-content:flex-start;
    }

    .miniBtn{
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      color:var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:800;
      font-size:12px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .miniBtn.primary{
      border-color: rgba(51,255,209,.35);
      background: linear-gradient(180deg, rgba(51,255,209,.18), rgba(0,0,0,.16));
    }

    .tableWrap{
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      background: rgba(0,0,0,.12);
      box-shadow: var(--shadow);
    }

    table{width:100%; border-collapse: collapse;}
    thead{background: rgba(0,0,0,.20)}
    th, td{padding:12px 12px; border-bottom:1px solid var(--line); vertical-align:top;}
    th{font-size:12px; color:var(--muted); text-align:right;}
    td{font-size:13px;}
    tbody tr:hover{background: rgba(255,255,255,.03)}

    .favCell{display:flex; align-items:flex-start; gap:10px; justify-content:flex-start;}

    .muted{color:var(--muted)}

    .empty{
      padding:24px;
      text-align:center;
      color:var(--muted);
      border:1px dashed rgba(255,255,255,.18);
      border-radius: var(--radius);
      background: rgba(0,0,0,.14);
    }

    @media (max-width: 980px){
      .hero{grid-template-columns: 1fr;}
      .controls{grid-template-columns: 1fr 1fr;}
      .grid{grid-template-columns: repeat(2, 1fr);}
      .stats{grid-template-columns: repeat(2, 1fr);}
    }

    @media (max-width: 620px){
      .controls{grid-template-columns: 1fr;}
      .grid{grid-template-columns: 1fr;}
      h1{font-size:24px}
    }

    /* Small toast */
    .toast{
      position: fixed;
      left: 14px;
      bottom: 14px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(10,14,28,.8);
      color: var(--text);
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events: none;
      font-weight: 800;
      font-size: 12px;
    }
    .toast.show{opacity:1; transform: translateY(0)}
  </style>
</head>
<body>
  <div class="wrap">

    <section class="hero">
      <div class="panel">
        <div class="heroMain">
          <h1>×˜×™×•×œ ×œ×¤××™ ×•×œ×¦×³×× ×’ ×××™ â€” ×˜×‘×¢ ×œ×–×•×’ (×‘×œ×™ ×›××‘ ×¨××©)</h1>
          <p class="sub">×”×•×¡×¤×ª×™ ×“×™×¨×•×’ ×§×•×©×™ (×§×œ/×‘×™× ×•× ×™/×§×©×”/×œ× ××¡×œ×•×œ) ×•××™×™× ×ª×™ ××ª ×”×¨×©×™××” ×›×š ×©"××¡×œ×•×œ×™×" ××•×¤×™×¢×™× ×¨××©×•×Ÿ ×œ×¤×™ ×§×•×©×™, ×•×”×“×‘×¨×™× ×©×”× ×œ× ××¡×œ×•×œ ×™×•×¨×“×™× ×œ×ª×—×ª×™×ª.</p>
        </div>
        <div class="stats" aria-label="×ª×§×¦×™×¨">
          <div class="stat"><b id="statCount">â€”</b><span>××˜×¨×§×¦×™×•×ª ×‘×¨×©×™××”</span></div>
          <div class="stat"><b id="statAreas">â€”</b><span>××–×•×¨×™×</span></div>
          <div class="stat"><b id="statTypes">â€”</b><span>×¡×•×’×™×</span></div>
          <div class="stat"><b id="statFavs">â€”</b><span>××•×¢×“×¤×™×</span></div>
        </div>
      </div>

      <div class="panel heroSide">
        <div class="tip">
          <div class="tipTitle"><span class="dot"></span><span>×›×œ×œ ×–×”×‘</span></div>
          <p>×‘×•×—×¨×™× ×¨×§ <b>××˜×¨×§×¦×™×” ××—×ª ×¢×™×§×¨×™×ª ×œ×™×•×</b>. ×× ××™×Ÿ ×›×•×— â€” ×¢×•×‘×¨×™× ××•×˜×•××˜×™×ª ×œ××•×¤×¦×™×” ×§×¦×¨×”/×§×¨×•×‘×”.</p>
        </div>
        <div class="tip">
          <div class="tipTitle"><span class="dot" style="background:var(--accent2); box-shadow:0 0 18px rgba(122,166,255,.45)"></span><span>×˜×™×¤ ×œ×§×•×©×™</span></div>
          <p>×—×•×/×œ×—×•×ª ×•×’×©× ×™×›×•×œ×™× ×œ×”×§×¤×™×¥ ×§×•×©×™. ×× ××ª× ×œ× ×‘×˜×•×—×™×â€”×ª×¡× × ×• ×œ<b>×§×œ</b> ×•×ª×ª×—×™×œ×• ××©×.</p>
        </div>
      </div>
    </section>

    <div class="toolbar" role="region" aria-label="×¡×™× ×•× ×™×">
      <div class="controls">
        <div class="input" title="×—×™×¤×•×© ×—×•×¤×©×™">
          <small>ğŸ”</small>
          <input id="q" type="search" placeholder="×—×¤×© ×œ×¤×™ ×©× / ××™×œ×•×ª ××¤×ª×—â€¦" autocomplete="off" />
        </div>

        <select id="areaSel" aria-label="×¡×™× ×•×Ÿ ×œ×¤×™ ××–×•×¨"></select>
        <select id="typeSel" aria-label="×¡×™× ×•×Ÿ ×œ×¤×™ ×¡×•×’"></select>
        <select id="diffSel" aria-label="×¡×™× ×•×Ÿ ×œ×¤×™ ×§×•×©×™"></select>

        <div class="btnRow">
          <button id="favOnlyBtn" class="btn" type="button">â­ ××•×¢×“×¤×™× ×‘×œ×‘×“</button>
          <button id="viewBtn" class="btn primary" type="button">×ª×¦×•×’×ª ×›×¨×˜×™×¡×™×</button>
          <button id="resetBtn" class="btn" type="button">××™×¤×•×¡</button>
        </div>
      </div>

      <div class="chips" id="chips" aria-label="×¤×™×œ×˜×¨×™× ××”×™×¨×™×"></div>
    </div>

    <main id="content" aria-live="polite"></main>

  </div>

  <div class="toast" id="toast">×”×•×¢×ª×§</div>

  <script>
    const DATA = [
      // ×¤××™
      { area: "×¤××™", type: "×ª×¦×¤×™×ª/×©×§×™×¢×”", name: "Pai Canyon (×§× ×™×•×Ÿ ×¤××™)", diff: "×§×©×”", desc: "×©×§×™×¢×” ×¢×œ ×¨×›×¡×™ ××‘×Ÿ ×¦×¨×™×; × ×¢×œ×™ ×©×˜×—, ×œ× ×œ×œ×›×ª ×‘×—×•×©×š." },
      { area: "×¤××™", type: "×©×•×§/××•×›×œ", name: "Walking Street (×©×•×§ ×”×œ×™×œ×”)", diff: "×œ× ××¡×œ×•×œ", desc: "×“×•×›× ×™ ×¢×¨×‘ ×œ××•×¨×š ×¨×—×³ Rungsiyanon; ×˜×™×•×œ ×¢×¨×‘ ×•×›×™×£ ×œ×–×•×’." },
      { area: "×¤××™", type: "××§×“×©/×ª×¦×¤×™×ª", name: "Wat Phra That Mae Yen (×”×‘×•×“×”×” ×”×œ×‘×Ÿ)", diff: "×‘×™× ×•× ×™", desc: "××§×“×© ×¢×œ ×”×’×‘×¢×” ×¢× ×ª×¦×¤×™×ª ×œ×¢××§; ×¢×œ×™×™×” ×‘××“×¨×’×•×ª." },
      { area: "×¤××™", type: "××¢×™×™×Ÿ ×—×", name: "Tha Pai Hot Springs", diff: "×œ× ××¡×œ×•×œ", desc: "×‘×¨×™×›×•×ª ××™× ×—××™× ×‘×ª×•×š ×¤××¨×§; ×‘×•×§×¨ ×¨×’×•×¢." },
      { area: "×¤××™", type: "××¢×™×™×Ÿ ×—×", name: "Sai Ngam Hot Spring", diff: "×œ× ××¡×œ×•×œ", desc: "×‘×¨×™×›×•×ª ×˜×‘×¢×™×•×ª ×‘×™×¢×¨ ×¦×¤×•× ×™×ª ×œ×¤××™; ×©×§×˜ ×•× ×¢×™×." },
      { area: "×¤××™", type: "××¤×œ/×©×›×©×•×š", name: "Mo Paeng Waterfall", diff: "×§×œ", desc: "××’×œ×©×•×ª ×¡×œ×¢ ×˜×‘×¢×™×•×ª; ××ª××™× ×œ×‘×•×§×¨/×¦×”×¨×™×™× ×§×œ×™×œ×™×." },
      { area: "×¤××™", type: "××¤×œ/×§× ×™×•×Ÿ ×¦×¨", name: "Pam Bok Waterfall", diff: "×§×œ", desc: "××¤×œ ×‘× ×§×™×§ ×¦×¨ ×¢× ×©×‘×™×œ ×§×¦×¨ ×¤× ×™××”." },
      { area: "×¤××™", type: "×—×§×œ××™/×™×™×—×•×“×™", name: "Land Split (×—×•×•×ª ×”-Land Split)", diff: "×œ× ××¡×œ×•×œ", desc: "×—×•×•×” ××©×¤×—×ª×™×ª ×¢× ×˜×¢×™××•×ª; ×œ×¤×¢××™× ×—×œ×§ ××”××ª×¨ ×¢×¦××• ×¡×’×•×¨â€”×©×•×•×” ×œ×‘×“×•×§ ×‘××§×•×." },
      { area: "×¤××™", type: "×©×‘×™×œ ×”×œ×™×›×” ×§×œ", name: "Boon Ko Ku So Bamboo Bridge", diff: "×§×œ", desc: "×’×©×¨ ×‘××‘×•×§ ××¨×•×š ××¢×œ ×©×“×•×ª ××•×¨×–; ×”×œ×™×›×” ×¨×•×× ×˜×™×ª." },
      { area: "×¤××™", type: "×ª×¦×¤×™×ª/×–×¨×™×—×”", name: "Yun Lai Viewpoint (×¡× ×˜×™×¦×³×•×Ÿ)", diff: "×œ× ××¡×œ×•×œ", desc: "×ª×¦×¤×™×ª ×¤× ×•×¨××™×ª ××¢×œ ×”×¢××§; ××•××œ×¥ ×œ×–×¨×™×—×”." },
      { area: "×¤××™", type: "×’×©×¨/× ×•×£", name: "Tha Pai Memorial Bridge", diff: "×œ× ××¡×œ×•×œ", desc: "×’×©×¨ ×¢×¥ ×”×™×¡×˜×•×¨×™ ×¢×œ ×›×‘×™×© 1095; ×¢×¦×™×¨×ª ×¦×™×œ×•×." },
      { area: "×¡×•×¤×¤×•× ×’ (×§×¨×•×‘ ×œ×¤××™)", type: "××¢×¨×”/×˜×‘×¢", name: "Tham Lod Cave", diff: "×‘×™× ×•× ×™", desc: "××¢×¨×” ×¢× ××“×¨×™×š ×•×¨×¤×¡×•×“×ª ×‘××‘×•×§; ×—×¦×™-×™×•× × ×•×— ××¤××™." },

      // ×¦×³×× ×’ ×××™
      { area: "×¦×³×× ×’ ×××™ â€“ ×“×•×™ ××™× ×ª× ×•×Ÿ", type: "×©××•×¨×”/×™×•× ××œ×", name: "Doi Inthanon National Park", diff: "×œ× ××¡×œ×•×œ", desc: "×™×•× ×˜×‘×¢ ×‘×’×•×‘×”: × ×§×³ ×ª×¦×¤×™×ª ×•××¤×œ×™×; ×§×¨×™×¨ ×•× ×¢×™×." },
      { area: "×¦×³×× ×’ ×××™ â€“ ×“×•×™ ××™× ×ª× ×•×Ÿ", type: "×©×‘×™×œ ×”×œ×™×›×”", name: "Kew Mae Pan Trail", diff: "×‘×™× ×•× ×™", desc: "××¡×œ×•×œ ×¨×›×¡ ×‘×¢× × ×™× (×‘×¢×•× ×ª ×”×—×•×¨×£); 2â€“3 ×©×¢×•×ª ×”×œ×™×›×”." },
      { area: "×¦×³×× ×’ ×××™ â€“ ×“×•×™ ××™× ×ª× ×•×Ÿ", type: "×©×‘×™×œ ×”×œ×™×›×”/×›×¤×¨", name: "Pha Dok Siew Trail", diff: "×‘×™× ×•× ×™", desc: "××¡×œ×•×œ ×™×¨×•×§ ×¢× ××¤×œ×™×; ××¡×ª×™×™× ×‘×›×¤×¨ ×¢× ×§×¤×” ××§×•××™." },
      { area: "×¦×³×× ×’ ×××™", type: "××¤×œ/××˜×¨×§×¦×™×”", name: "Bua Thong Sticky Waterfall", diff: "×‘×™× ×•× ×™", desc: "â€œ×”××¤×œ×™× ×”×“×‘×™×§×™×â€ â€” ××˜×¤×¡×™× ×¢×œ ××‘×Ÿ ×’×™×¨ ×©××™× ×” ××—×œ×™×§×”." },
      { area: "×¦×³×× ×’ ×××™ â€“ ×××” ×¨×™×", type: "×’× ×™×/×’×©×¨ ×¦××¨×•×ª", name: "Queen Sirikit Botanic Garden", diff: "×œ× ××¡×œ×•×œ", desc: "×’× ×™× ×‘×•×˜× ×™×™× + Canopy Walkway ×‘×’×•×‘×” ×”×¢×¦×™×." },
      { area: "×¦×³×× ×’ ×××™ â€“ ×“×•×™ ×¡×•×˜×¤", type: "×©×‘×™×œ/×× ×–×¨", name: "Monkâ€™s Trail â†’ Wat Pha Lat", diff: "×‘×™× ×•× ×™", desc: "×”×œ×™×›×” ×‘×’×³×•× ×’×œ ××œ Wat Pha Lat; 45â€“90 ×“×§×•×ª." },
      { area: "×¦×³×× ×’ ×××™ â€“ ×“×•×™ ×¡×•×˜×¤", type: "××§×“×©/×ª×¦×¤×™×ª", name: "Wat Phra That Doi Suthep", diff: "×œ× ××¡×œ×•×œ", desc: "××§×“×© ×—×©×•×‘ ×•×ª×¦×¤×™×ª ×¢×œ ×”×¢×™×¨; × ×’×™×© ×‘×¨×›×‘/××•× ×™×ª." },
      { area: "×¦×³×× ×’ ×××™ (××–×•×¨)", type: "×¤×™×œ×™×/×©×™×§×•×", name: "Elephant Nature Park", diff: "×œ× ××¡×œ×•×œ", desc: "×‘×™×§×•×¨ ×œ×œ× ×¨×›×™×‘×”; ×œ×”×–××™×Ÿ ××¨××©. ××ª××™× ×œ×™×•× ×¨×’×•×¢ ×•××¨×’×©." },
    ];

    // ----- helpers -----
    const $ = (id) => document.getElementById(id);

    function uniq(arr){
      return Array.from(new Set(arr)).sort((a,b)=>a.localeCompare(b,'he'));
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    function toast(msg){
      const el = $('toast');
      el.textContent = msg;
      el.classList.add('show');
      window.clearTimeout(el._t);
      el._t = window.setTimeout(()=>el.classList.remove('show'), 1200);
    }

    function copyText(text){
      navigator.clipboard?.writeText(text).then(()=>toast('×”×•×¢×ª×§'))
        .catch(()=>{
          const ta = document.createElement('textarea');
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          ta.remove();
          toast('×”×•×¢×ª×§');
        });
    }

    function mapUrl(item){
      const q = `${item.name} ${item.area}`;
      return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`;
    }

    function openMap(url){
      let w = null;
      try { w = window.open(url, '_blank', 'noopener'); } catch(e) {}
      if(!w){
        copyText(url);
        toast('×§×™×©×•×¨ ×œ××¤×” ×”×•×¢×ª×§');
      }
    }

    // ----- difficulty -----
    const DIFF_ORDER = {
      '×§×œ': 1,
      '×‘×™× ×•× ×™': 2,
      '×§×©×”': 3,
      '×œ× ××¡×œ×•×œ': 99,
    };

    function diffValue(item){
      return DIFF_ORDER[item.diff] ?? 99;
    }

    function compareByDifficulty(a,b){
      const aIsTrail = diffValue(a) !== 99;
      const bIsTrail = diffValue(b) !== 99;

      // ××¡×œ×•×œ×™× (×§×œ/×‘×™× ×•× ×™/×§×©×”) ×ª××™×“ ×œ×¤× ×™ "×œ× ××¡×œ×•×œ"
      if(aIsTrail !== bIsTrail) return aIsTrail ? -1 : 1;

      // ×‘×ª×•×š ××¡×œ×•×œ×™×: ×§×œ->×§×©×”
      const d = diffValue(a) - diffValue(b);
      if(d !== 0) return d;

      // ×˜×™×¢-×‘×¨×™×™×§: ××–×•×¨ ×•××– ×©×
      const ar = a.area.localeCompare(b.area, 'he');
      if(ar !== 0) return ar;
      return a.name.localeCompare(b.name, 'he');
    }

    // ----- favorites -----
    const FAV_KEY = 'trip_favs_v1';

    function itemId(item){
      return `${item.name}|${item.area}`.toLowerCase();
    }

    function loadFavs(){
      try {
        const raw = localStorage.getItem(FAV_KEY);
        if(!raw) return new Set();
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr)) return new Set();
        return new Set(arr);
      } catch(e){
        return new Set();
      }
    }

    function saveFavs(){
      try {
        localStorage.setItem(FAV_KEY, JSON.stringify(Array.from(favs)));
      } catch(e) {}
    }

    function isFav(item){
      return favs.has(itemId(item));
    }

    function toggleFavById(id){
      if(favs.has(id)) favs.delete(id);
      else favs.add(id);
      saveFavs();
    }

    // ----- state -----
    let view = 'cards';
    let activeChip = '×”×›×•×œ';
    let favoritesOnly = false;
    const favs = loadFavs();

    function updateFavBtn(){
      const btn = $('favOnlyBtn');
      if(!btn) return;
      btn.classList.toggle('starOn', favoritesOnly);
      btn.textContent = favoritesOnly ? 'â­ ×›×œ ×”×¨×©×™××”' : 'â­ ××•×¢×“×¤×™× ×‘×œ×‘×“';
      $('statFavs').textContent = favs.size;
    }

    // ----- init selects -----
    function initUI(){
      const areas = uniq(DATA.map(d=>d.area));
      const types = uniq(DATA.map(d=>d.type));
      const diffs = uniq(DATA.map(d=>d.diff));

      $('areaSel').innerHTML = [
        `<option value="">×›×œ ×”××–×•×¨×™×</option>`,
        ...areas.map(a=>`<option value="${escapeHtml(a)}">${escapeHtml(a)}</option>`)
      ].join('');

      $('typeSel').innerHTML = [
        `<option value="">×›×œ ×”×¡×•×’×™×</option>`,
        ...types.map(t=>`<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`)
      ].join('');

      $('diffSel').innerHTML = [
        `<option value="">×›×œ ×”×§×©×™×™×</option>`,
        ...diffs.map(d=>`<option value="${escapeHtml(d)}">×§×•×©×™: ${escapeHtml(d)}</option>`)
      ].join('');

      const chipList = ['×”×›×•×œ', '×¤××™', "×¦×³×× ×’ ×××™"];
      $('chips').innerHTML = chipList.map(c =>
        `<button class="chip ${c==='×”×›×•×œ'?'active':''}" data-chip="${escapeHtml(c)}" type="button">${escapeHtml(c)}</button>`
      ).join('');

      // Stats
      $('statCount').textContent = DATA.length;
      $('statAreas').textContent = areas.length;
      $('statTypes').textContent = types.length;
      $('statFavs').textContent = favs.size;

      // events
      $('q').addEventListener('input', render);
      $('areaSel').addEventListener('change', render);
      $('typeSel').addEventListener('change', render);
      $('diffSel').addEventListener('change', render);

      $('favOnlyBtn').addEventListener('click', ()=>{
        favoritesOnly = !favoritesOnly;
        updateFavBtn();
        render();
      });

      $('resetBtn').addEventListener('click', ()=>{
        $('q').value = '';
        $('areaSel').value = '';
        $('typeSel').value = '';
        $('diffSel').value = '';
        favoritesOnly = false;
        updateFavBtn();
        activeChip = '×”×›×•×œ';
        document.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.chip===activeChip));
        render();
      });

      $('viewBtn').addEventListener('click', ()=>{
        view = (view === 'cards') ? 'table' : 'cards';
        $('viewBtn').textContent = (view === 'cards') ? '×ª×¦×•×’×ª ×›×¨×˜×™×¡×™×' : '×ª×¦×•×’×ª ×˜×‘×œ×”';
        render();
      });

      $('chips').addEventListener('click', (e)=>{
        const btn = e.target.closest('.chip');
        if(!btn) return;
        activeChip = btn.dataset.chip;
        document.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.chip===activeChip));

        // sync select when possible
        if(activeChip === '×¤××™'){
          $('areaSel').value = '×¤××™';
        } else {
          $('areaSel').value = '';
        }
        render();
      });

      updateFavBtn();
      render();
    }

    function matchesChip(item){
      if(activeChip === '×”×›×•×œ') return true;
      if(activeChip === '×¤××™') return item.area === '×¤××™' || item.area.includes('×¤××™');
      if(activeChip === "×¦×³×× ×’ ×××™") return item.area.includes("×¦×³×× ×’ ×××™");
      return true;
    }

    function filtered(){
      const q = $('q').value.trim().toLowerCase();
      const area = $('areaSel').value;
      const type = $('typeSel').value;
      const diff = $('diffSel').value;

      return DATA.filter(item => {
        if(!matchesChip(item)) return false;

        if(favoritesOnly && !isFav(item)) return false;

        // area filter
        if(area){
          if(item.area !== area) return false;
        } else {
          if(activeChip === "×¦×³×× ×’ ×××™" && !item.area.includes("×¦×³×× ×’ ×××™")) return false;
        }

        // type filter
        if(type && item.type !== type) return false;

        // diff filter
        if(diff && item.diff !== diff) return false;

        // search
        if(q){
          const hay = `${item.name} ${item.area} ${item.type} ${item.diff} ${item.desc}`.toLowerCase();
          if(!hay.includes(q)) return false;
        }

        return true;
      });
    }

    function render(){
      const list = filtered().slice().sort(compareByDifficulty);
      const content = $('content');

      if(list.length === 0){
        content.innerHTML = `<div class="empty">×œ× × ××¦××• ×ª×•×¦××•×ª. × ×¡×” ×œ×©× ×•×ª ×¡×™× ×•×Ÿ/×—×™×¤×•×© ××• ×œ×›×‘×•×ª â€œ××•×¢×“×¤×™× ×‘×œ×‘×“â€.</div>`;
        return;
      }

      if(view === 'cards'){
        content.innerHTML = `
          <div class="grid">
            ${list.map(item => cardHtml(item)).join('')}
          </div>
        `;
      } else {
        content.innerHTML = tableHtml(list);
      }

      // handlers (××—×¨×™ ×¨× ×“×¨)
      content.querySelectorAll('[data-copy]').forEach(btn=>{
        btn.addEventListener('click', ()=>copyText(btn.getAttribute('data-copy')));
      });

      content.querySelectorAll('[data-map]').forEach(btn=>{
        btn.addEventListener('click', ()=>openMap(btn.getAttribute('data-map')));
      });

      content.querySelectorAll('[data-fav]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-fav');
          toggleFavById(id);
          updateFavBtn();
          render();
        });
      });
    }

    function starChar(fav){
      return fav ? 'â˜…' : 'â˜†';
    }

    function cardHtml(item){
      const q = `${item.name} â€” ${item.area}`;
      const id = itemId(item);
      const fav = favs.has(id);
      return `
        <article class="card">
          <div class="cardTop">
            <div class="titleRow">
              <div>
                <h3 class="name">${escapeHtml(item.name)}</h3>
                <div class="meta">
                  <span class="pill">${escapeHtml(item.area)}</span>
                  <span class="pill">${escapeHtml(item.type)}</span>
                  <span class="pill diff">×§×•×©×™: ${escapeHtml(item.diff)}</span>
                </div>
              </div>
              <button class="starBtn ${fav ? 'fav' : ''}" type="button" aria-label="××•×¢×“×£" title="××•×¢×“×£" data-fav="${escapeHtml(id)}">${starChar(fav)}</button>
            </div>
          </div>
          <div class="cardBody"><p>${escapeHtml(item.desc)}</p></div>
          <div class="cardActions">
            <button class="miniBtn primary" type="button" data-map="${escapeHtml(mapUrl(item))}">ğŸ—ºï¸ ××¤×”</button>
            <button class="miniBtn" type="button" data-copy="${escapeHtml(q)}">ğŸ“‹ ×”×¢×ª×§×”</button>
          </div>
        </article>
      `;
    }

    function tableHtml(list){
      return `
        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>××˜×¨×§×¦×™×”</th>
                <th>×”×¡×‘×¨</th>
                <th>×¡×•×’</th>
                <th>×§×•×©×™</th>
                <th>××–×•×¨</th>
                <th>××¤×”</th>
                <th>×”×¢×ª×§×”</th>
              </tr>
            </thead>
            <tbody>
              ${list.map(item => {
                const q = `${item.name} â€” ${item.area}`;
                const id = itemId(item);
                const fav = favs.has(id);
                return `
                  <tr>
                    <td>
                      <div class="favCell">
                        <button class="starBtn ${fav ? 'fav' : ''}" type="button" aria-label="××•×¢×“×£" title="××•×¢×“×£" data-fav="${escapeHtml(id)}">${starChar(fav)}</button>
                        <div><b>${escapeHtml(item.name)}</b></div>
                      </div>
                    </td>
                    <td>${escapeHtml(item.desc)}</td>
                    <td class="muted">${escapeHtml(item.type)}</td>
                    <td class="muted">${escapeHtml(item.diff)}</td>
                    <td class="muted">${escapeHtml(item.area)}</td>
                    <td><button class="miniBtn primary" type="button" data-map="${escapeHtml(mapUrl(item))}">ğŸ—ºï¸ ××¤×”</button></td>
                    <td><button class="miniBtn" type="button" data-copy="${escapeHtml(q)}">ğŸ“‹ ×”×¢×ª×§×”</button></td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // --- lightweight tests (console only) ---
    function runTests(){
      try {
        console.assert(DATA.every(x => typeof x.diff === 'string' && x.diff.length > 0), 'Every item should have a diff string');

        const sorted = DATA.slice().sort(compareByDifficulty);
        const firstNonTrailIdx = sorted.findIndex(x => diffValue(x) === 99);
        if(firstNonTrailIdx !== -1){
          console.assert(sorted.slice(firstNonTrailIdx).every(x => diffValue(x) === 99), 'Non-trails should be grouped at the end');
        }

        console.assert(typeof mapUrl(DATA[0]) === 'string' && mapUrl(DATA[0]).includes('google.com/maps/search'), 'mapUrl should return a Google Maps search URL');

        // Favorites: add/remove should not throw
        const id0 = itemId(DATA[0]);
        const had = favs.has(id0);
        toggleFavById(id0);
        console.assert(favs.has(id0) !== had, 'toggleFav should flip state');
        toggleFavById(id0);
        console.assert(favs.has(id0) === had, 'toggleFav should restore state');

        // Diff filter sanity
        $('diffSel').value = '×§×œ';
        const easy = filtered();
        console.assert(easy.every(x => x.diff === '×§×œ'), 'diff filter should keep only selected diff');
        $('diffSel').value = '';

      } catch (e) {
        console.warn('Tests failed:', e);
      }
    }

    initUI();
    runTests();
  </script>
</body>
</html>
